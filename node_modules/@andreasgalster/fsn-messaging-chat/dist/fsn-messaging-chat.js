'use strict';

require('@polymer/polymer/polymer.html');
require('@polymer/paper-button/paper-button.html');
require('@polymer/iron-flex-layout/iron-flex-layout.html');

require('@andreasgalster/fsn-boilerplate/dist/fsn-boilerplate.html');

require('../../fb-user-image.html');

// require('../../fsn-messaging-input/src/fsn-messaging-input.html');
require('@andreasgalster/fsn-messaging-input/dist/fsn-messaging-input.html');

Polymer({
  is: 'fsn-messaging-chat',
  behaviors: [mwcMixin],
  properties: {
    messageId: {
      type: String,
      observer: 'getMessages'
    },
    messages: Array,
    toUserId: String,
    userSelected: Boolean
  },
  listeners: {
    'fsn-message-sent': 'scrollDown'
  },
  userIdAvailable: function userIdAvailable(toUserId) {
    if (toUserId) {
      return true;
    }
  },
  getMessages: function getMessages() {
    var _this = this;

    this.subscribe('PrivateMessagesDetail', this.messageId);
    this.autorun(function () {
      _this.messages = PrivateMessagesDetail.find({ messageId: _this.messageId },
      // {  },
      {
        sort: { createdAt: 1 }
      }).fetch();
    });
  },
  scrollDown: function scrollDown() {
    var scrollBottom = this.$$('main').scrollTop + this.$$('main').offsetHeight + 150;
    this.$$('main').scrollTop = scrollBottom;
  }

});