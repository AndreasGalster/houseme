<dom-module id='cloudinary-upload'>
  <template>
    <style include='houseme-styles'></style>
    <style>
      iron-image {
        width: 200px;
        padding-bottom: 6%;
        background-color: gray;
      }

      label {
        width: 200px;
        padding-bottom: 3%;
        margin: 0;
      }

      input {
        display: none;
      }
    </style>

    <iron-image
      sizing='cover'
      preload
      fade
      src=[[imageUrl]]>
    </iron-image>

<!-- https://res.cloudinary.com/pigments/image/upload/w_150,h_90,c_fill,q_70/{{item.downloadurl}} -->

    <label for='image'>
      <input id='image' on-change='uploadImage' type='file' accept='.png, .gif, .jpg, .jpeg'>
    </label>

  </template>
</dom-module>

<script>
  require('@polymer/polymer/polymer.html');
  require('@polymer/iron-image/iron-image.html');

  require('@andreasgalster/fsn-boilerplate/dist/fsn-boilerplate.html');

  Polymer({
    is: 'cloudinary-upload',
    properties: {
      imagesAvailable: Boolean,
      valid: Boolean,
      imageId: {
        type: String,
        observer: 'imageUrl'
      },
      baseUrl: {
        type: String,
        value: `https://res.cloudinary.com/${Meteor.settings.public.cloudinary.cloud_name}/image/upload/`
      }
    },
    // uploadImage: function(e) {
    //   console.log(e.currentTarget.files[0]);
    //   let file = e.currentTarget.files[0];
    //   // let file = e.currentTarget.files[0].name;
    //   Meteor.call('imageUpload', file, (err, res) => {
    //     console.log('blubb');
    //     if(err) {
    //       console.log(err);
    //       console.log(`error is ${err}`);
    //       return;
    //     } else {
    //       console.log(res);
    //       // console.log(`result is ${res}`);
    //       this.imageId = res;
    //       this.valid = true;
    //     }
    //   });
    // },

    uploadImage: function(e) {
      const file = e.currentTarget.files[0];
      const cloudinary = require('cloudinary');
      cloudinary.config({
        cloud_name: Meteor.settings.public.cloudinary.cloud_name,
        api_key: Meteor.settings.public.cloudinary.api_key,
        api_secret: Meteor.settings.public.cloudinary.api_secret
      });

      // this.imageId = res;
      // this.valid = true;
      cloudinary.v2.uploader.upload(file,{
        crop: 'limit', width: 400, height: 400, tags: ['profileImages'], folder: 'profileImages',
      }, (err, res) => console.log(res));
    },




    imageUrl: function() {
      // return
      // this.imageId ?
      // `${this.baseUrl}w_150,h_90,c_fill,q_70/${this.ImageId}` :
      // `${this.baseUrl}w_150,h_90,c_fill,q_70/yolo`;

      return `${this.baseUrl}w_150,h_90,c_fill,q_70/${this.ImageId}`

    }

  });

</script>
